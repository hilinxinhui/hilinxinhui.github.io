<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Python虚拟环境和conda | hilinxinhui</title>

  
  <meta name="author" content="Xinhui Lin">
  

  
  <meta name="description" content="Conda is an open source package management system and environment management system for installing multiple versions of software packages and their dependencies and switching easily between them. It works on Linux, OS X and Windows, and was created for Python programs but can package and distribute any software.

这里有几个早些时候录制的演示视频：

安装conda
使用conda（上）
使用conda（下）">
  

  
  
  <meta name="keywords" content="conda,virtual environment">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="Python虚拟环境和conda"/>

  <meta property="og:site_name" content="hilinxinhui"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="hilinxinhui" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
  <link href="https://fonts.lug.ustc.edu.cn/css?family=Lato|Rubik" rel="stylesheet">
  <script src="/js/pangu-407.min.js"></script>
<meta name="generator" content="Hexo 6.3.0"></head>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    pangu.autoSpacingPage();
  });
</script>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">hilinxinhui</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/about">关于</a></li>
      
        <li><a href="/atom.xml">订阅</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>Python虚拟环境和conda</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2023/07/10/Python虚拟环境和conda/" rel="bookmark">
        <time class="entry-date published" datetime="2023-07-10T11:58:08.000Z">
          2023-07-10
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        

<script type="text/javascript">
    function convertRemToPixels(rem) {    
        return rem * parseFloat(getComputedStyle(document.documentElement).fontSize);
    }
    window.onscroll = function() {
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        if (scrollTop > convertRemToPixels(40)) {
            document.getElementsByClassName('toc-article')[0].style.visibility = 'visible';
        } else {
            document.getElementsByClassName('toc-article')[0].style.visibility = 'hidden';
        }
    }
</script>


<div id="toc" class="toc-article">
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#conda"><span class="toc-text">conda</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-mini-conda"><span class="toc-text">安装(mini)conda</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84conda%E5%91%BD%E4%BB%A4"><span class="toc-text">常用的conda命令</span></a></li></ol></li></ol>
      </div>
</div>
<style>
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>



        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>Conda is an open source package management system and environment management system for installing multiple versions of software packages and their dependencies and switching easily between them. It works on Linux, OS X and Windows, and was created for Python programs but can package and distribute any software.</p>
</blockquote>
<p>这里有几个早些时候录制的演示视频：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1p44y1x7Tw">安装conda</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1LY411t7sP">使用conda（上）</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ku41127ko">使用conda（下）</a></li>
</ul>
<span id="more"></span>

<h2 id="conda"><a href="#conda" class="headerlink" title="conda"></a>conda</h2><p>很多情况下划分不同的Python虚拟环境是有必要的。Python提供了<code>venv</code>工具实现虚拟环境管理，这个工具很轻，但权限有限，且只能使用<code>pip</code>进行软件包管理。<code>conda</code>解决了<code>venv</code>的问题，是一个更强大的虚拟环境管理工具。</p>
<p>具体地，<code>miniconda</code>相比与<code>Anaconda</code>更轻量，下载和安装都更快。</p>
<h3 id="安装-mini-conda"><a href="#安装-mini-conda" class="headerlink" title="安装(mini)conda"></a>安装(mini)conda</h3><p>由于种种原因，访问<code>conda</code>官网通常不太顺利，作者一般用<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/">清华大学镜像站</a>替代。</p>
<p>在<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/">这里</a>可以看到<code>conda</code>镜像使用帮助，<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/">这里</a>提供<code>miniconda</code>安装包&#x2F;脚本存档。</p>
<p>这篇文章写于2023年7月10日，此时能下载的最新的<code>miniconda</code>版本是<code>4.9.2</code>，以<code>Linux_x86_64</code>系统为例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-py39_4.9.2-Linux-x86_64.sh <span class="comment"># 下载</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">bash Miniconda3-py39_4.9.2-Linux-x86_64.sh <span class="comment"># 安装，一般不需要sudo权限</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">依据提示接受条款、选择安装路径、写入环境变量（安装脚本自动完成，用户选择是/否即可）</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">source</span> ~/.bashrc <span class="comment"># 或新开一个终端窗口</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认在&lt;用户-主机-命令提示符&gt;这串东西前出现(base)字样，表示当前所处的虚拟环境</span></span><br></pre></td></tr></table></figure>

<p>个人习惯，一般不用base环境。</p>
<h3 id="常用的conda命令"><a href="#常用的conda命令" class="headerlink" title="常用的conda命令"></a>常用的conda命令</h3><p>使用conda的工作流可能像这样：</p>
<ul>
<li>创建环境和激活环境</li>
<li>安装各种需要的东西（以PyTorch为例）</li>
<li>查看所有</li>
<li>导出环境</li>
<li>依据导出的环境创建环境（导入环境）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有conda环境</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">conda <span class="built_in">env</span> list</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">conda info -e <span class="comment"># 请看茴香豆的另一种吃法</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">conda info --envs <span class="comment"># 请看茴香豆的再一种吃法</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建conda环境（更准确地说是Python虚拟环境），下面演示茴香豆的若干种吃法</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">conda create -n &lt;env_name&gt;</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">conda create -n &lt;env_name&gt; python=&lt;python_version&gt;</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">conda create -n py3.8 python=3.8 numpy pandas matplotlib <span class="comment"># 一个实际的例子</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装各种东西</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">conda activate py3.8</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">conda install pytorch torchvision torchaudio pytorch-cuda=11.7 -c pytorch -c nvidia <span class="comment"># PyTorch为例</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pip install <span class="comment"># “在conda里也可以用pip”</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装之前可以先搜索所有可用版本，再指定某一具体版本</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">conda uninstall numpy <span class="comment"># 以numpy为例，先卸载当前安装的版本</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">conda search numpy</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">conda install numpy=&lt;version_id&gt;=&lt;build_id&gt; <span class="comment"># build_id即子版本号，要注意version_id太小（安装古早版本的numpy可能导致依赖崩溃使得无法安装）</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">导出和导入</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">conda <span class="built_in">env</span> <span class="built_in">export</span> -n &lt;env_name&gt; &gt; &lt;export_file_name&gt;.yaml</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">conda <span class="built_in">env</span> create -f &lt;export_file_name&gt;.yaml <span class="comment"># 其实是创建一个新环境</span></span></span><br></pre></td></tr></table></figure>

<p>除了上述命令外，还有：</p>
<ul>
<li>查看conda版本：看这个干什么？</li>
<li>更新conda：用conda命令的时候会返回更新提示，照做就好</li>
<li>更新其他包（如numpy）：相信我你不会想更新的，如果需要用更新版本的包（如升级torch1.x到2.x），应该新开一个环境</li>
<li>换源：这个确实重要，看tuna的文档就行，顺便说一句，conda的配置写在<code>~/.condarc</code>文件中</li>
<li>查看当前环境中安装了哪些东西：<code>conda list</code>，通常后面接<code>grep</code>查看某个具体的包的信息</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Dev/">Dev</a>, <a href="/categories/Dev/Python/">Python</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/conda/">conda</a><a href="/tags/virtual-environment/">virtual environment</a>
    </span>
    

    </div>

    
  </div>
</article>

  






    </main>

    <footer class="site-footer">
  <p class="site-info">
    Deployed by <a href="https://github.com/kaedea/notion-down" target="_blank">notion-down</a> and
    Theme by <a href="https://github.com/kaedea/hexo-theme-hacker" target="_blank">hexo-theme-hacker</a>
    </br>
    
    &copy; 2024 Xinhui Lin
    
  </p>
</footer>
    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'G-J38N5N288S', 'auto');
    ga('send', 'pageview');

</script>

  </div>
</div>
</body>
</html>